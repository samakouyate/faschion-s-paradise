!function(){let e=e=>e?(/^[?#]/.test(e)?e.slice(1):e).split("&").reduce((e,t)=>{let[n,o]=t.split("=");return e[n]=o?decodeURIComponent(o.replace(/\+/g," ")):"",e},{}):{},t=(e,t)=>e in t&&t[e],n=e=>parseInt(e)-0==parseInt(e);var o="undefined.361912";for(tdl.identify=a,tdl.convert=i,"string"==typeof window.tdl.domain&&(window.tdl.domain={default:window.tdl.domain});window.tdl.length&&tdl.domain;){let e=window.tdl.shift(),t=e[0],n=e.slice(1),o=e[2],r=e[3];switch(o||(o=()=>{}),r||(r=()=>{}),t){case"identify":a(...n).then(o).catch(r);break;case"convert":i(...n).then(o).catch(r)}}async function i(n={}){let o=[];var i={...n,...e(window.location.search)};for(let e in window.tdl.domain){let d=[],c=f(n,e),s=c!=="tdl_"+e,u=function(e,t){let n=[],o=decodeURIComponent(document.cookie).split(";");for(let i=0;i<o.length;i++){let r=o[i].split("=");(r[0].trim()==e||!1===t&&r[0].trim().includes(e))&&n.push(r[1].trim())}return n}(c,s);if(u.length>0&&(d=u),!s||0==d.length){let e=function(e,t){let n=[];if(!0===t){let t=window.localStorage.getItem(e);t&&n.push(t)}else Object.keys(localStorage).filter(t=>t.includes(e)).forEach(e=>n.push(localStorage.getItem(e)));return n}(c,s);e.length>0&&(d=d.concat(e))}if("goal_id"in n||"goal_ref"in n||"goal_name"in n)var a=window.tdl.domain[e]+"/aff_goal?a=lsr&";else var a=window.tdl.domain[e]+"/aff_lsr?";o.concat(function(e,t,n){let o=[],i=[];if(t.length>0){let a=r(n);for(let n of t){let t=a.length>0?"&":"";o.push(`${e}transaction_id=${n}${t}${a}`)}for(let e of o)i.push(l(e))}return i}(a,d,n)),0==o.length&&o.concat(function(e,n){if(!t("promo_code",n))return[];{let t=r(n);return[l(`${e}${t}`)]}}(a,n)),0==o.length&&o.concat(function(e,t){e=e.endsWith("/")?e.slice(0,-1):e;let n=`${e}/ping`,o=r(t,!1);return[l(n=""===o?`${n}`:`${n}?${o}`)]}(window.tdl.domain[e],i))}return Promise.allSettled(o)}function r(e,n=!0){let o="",i=new Set(["offer_ref","offer_id"]);for(let r in e){if(n&&i.has(r)||!t(r,e))continue;let l=o.length>0?"&":"",a=encodeURIComponent(r),d=encodeURIComponent(e[r]);o+=`${l}${a}=${d}`}return o}function l(e){let t=encodeURI(e);return fetch(t,{mode:"cors",headers:{"Tune-SDK-Version":o}})}async function a(o={},i={}){var r=Object.keys(window.tdl.domain).length>1,l={...o,...e(window.location.search),...i};if(r&&t("network_id",l)&&t(l.network_id,window.tdl.domain))var a=l.network_id;else if(r)return;else var a=Object.keys(window.tdl.domain)[0];let s=f(l,a);if(null===window.sessionStorage.getItem(s)){if(t("transaction_id",l))c(l.transaction_id,s);else{if(!((t("aff_id",l)&&n(l.aff_id)||t("aff_ref",l))&&(t("offer_id",l)&&n(l.offer_id)||t("offer_ref",l)))||"transaction_id"in l)return;var u=await d(l,a);u&&c(u,s)}}}async function d(e,n){let i=window.tdl.domain[n]+"/aff_c?";for(let n in e)t(n,e)&&(i=i+"&"+n+"="+e[n]);i+="&format=json";let r=async()=>{let e=encodeURI(i),t=await fetch(e,{mode:"cors",headers:{"Tune-SDK-Version":o}});return(await t.json()).response.data.transaction_id},l=await r();return await l}function c(e,t){let n;!0===(document.cookie="cookie_test=test",n=-1!==document.cookie.indexOf("cookie_test="),document.cookie="cookie_test=;max-age=0",n)?function(e,t){try{window.sessionStorage.setItem(t,e.toString())}catch(e){console.error(e)}let n=window.location.hostname.split("."),o="";for(let e=n.length-2;e>=0;e--){let t=n.slice(e,n.length).join(".");if(console.log("testing domain: ",t),function(e){document.cookie="tunesdktest=test; domain="+e+"; max-age=60; path=/;";let t=-1!==document.cookie.indexOf("tunesdktest=");return document.cookie="tunesdktest=;max-age=0;",t}(t)){console.log("found domain: ",o=t);break}}""!==o&&function(e,t,n,o){try{let i="";if(o){let e=new Date;e.setTime(e.getTime()+864e5*o),i="; expires="+e.toUTCString()}let r="";n&&(r="; domain=."+n),document.cookie=e+"="+(t||"")+r+i+"; path=/;"}catch(e){return!1}}(t,e,o,1825)}(e,t):function(e,t){try{window.sessionStorage.setItem(t,e.toString()),window.localStorage.setItem(t,e.toString())}catch(e){console.error(e)}}(e,t)}function f(e,o){let i="";return t("offer_id",e)&&n(e.offer_id)?i="_"+e.offer_id:t("offer_ref",e)&&(i="_"+e.offer_ref),"tdl_"+o+i}}();
//# sourceMappingURL=tune.js.map
